<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.3.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">
    <changeSet id="cms-structure-04-09-2025-01-01" author="Nganph">
        <sql>
            create table record_ (
                                     id bigserial primary key,
                                     request_id varchar(100),
                                     leak_id varchar(200),
                                     severity smallint,
                                     description varchar(700),
                                     source varchar(200),
                                     leak_name varchar(200),
                                     data_published_time bigint,
                                     detectTime bigint,
                                     status smallint,
                                     created_by varchar(100),
                                     created_date timestamp,
                                     last_modified_by varchar(100),
                                     last_modified_date timestamp
            );
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-02" author="Nganph">
        <sql>
            CREATE TABLE  shedlock (
                                         name        VARCHAR(64)  NOT NULL,
                                         lock_util  TIMESTAMP(3) WITH TIME ZONE NOT NULL,
                                         locked_at   TIMESTAMP(3) WITH TIME ZONE NOT NULL,
                                         locked_by   VARCHAR(255) NOT NULL,
                                         CONSTRAINT shedlock_pkey PRIMARY KEY (name)
            );


            CREATE INDEX IF NOT EXISTS shedlock_lock_until_idx ON shedlock (lock_util);
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-03" author="Nganph">
        <sql>
            ALTER TABLE record_ ADD COLUMN meta jsonb not null default '{}'::jsonb;
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-04" author="Nganph">
        <sql>
            ALTER TABLE record_ ADD COLUMN data_source varchar(200) not null;
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-05" author="Nganph">
        <sql>
            ALTER TABLE record_ ADD COLUMN types varchar(255) not null;
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-06" author="Nganph">
        <sql>
            ALTER TABLE record_ ADD COLUMN detect_time bigint not null;
        </sql>
    </changeSet>

    <changeSet id="cms-structure-04-09-2025-01-07" author="Nganph">
        <sql>
            ALTER TABLE record_ DROP COLUMN description;
            ALTER TABLE record_ ADD COLUMN description text;
        </sql>
    </changeSet>

</databaseChangeLog>